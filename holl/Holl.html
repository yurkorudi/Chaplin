<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="form">
        <form action="" method="post">
            <label for="rows">Row count</label>
            <input type="number" name="rows" id="rows">
            <label for="columns">Coluns count</label>
            <input type="number" name="columns" id="columns">
            <button type="button" onclick="main()">Submit</button>
        </form>
    </div>
    <div class="main">
        <div class="holls">
            <a href="">Holl_1</a>
            <a href="">Holl_2</a>
        </div>
        <div id="holl" class="holl"></div>        
    </div>
    
    <button type="button" onclick="">Submit</button>
    <script>
        let startColumns;
        let extraRows = [];

        function getData(inputID){
            const input = document.getElementById(inputID);
            const value = Number(input.value);
            
            valid = checkValid(input, value);
            
            if (valid){
                return value;
            }
        }

        function checkValid(input, value){
            if (!isNaN(value) && value != " "){
                return true;
            }
            else{
                input.value = "";
                return false;
            }
        }

        function setHollStyle(holl, columns){
            const number = columns + 1;
            holl.style.gridTemplateColumns = `repeat(${number}, 1fr)`;
        }

        function createElement(element, ...className){
            const created = document.createElement(element);
            created.classList.add(...className);
            return created;
        }

        function createFill(holl, rows, columns, empty = false){
            placeCount = rows * columns;
            t = 1;
            rowCount = 1;
            extraSeats = 0;

            for (let i = 1; i <= placeCount; i++){
                k = (i - 1) % columns + 1;
                
                if (k == 1){
                    count = extraRows.filter(n => n === rowCount).length;
                    extraSeats = count - extraSeats;
                }
                
                if(!empty){
                    seat = createElement("div", "seat");
                }
                else{
                    if(k <= startColumns){
                        seat = createElement("div", "seat");
                    }
                    else if(extraSeats > 0){
                        seat = createElement("div", "seat");
                        extraSeats--;
                    }
                    else{                      
                        seat = createElement("div", "empty");
                    }
                }

                
                
                // const seatDetails = {seatPlace: 1 }
                holl.appendChild(seat);
         
                if (t == columns || i == placeCount){
                    const addButton = createElement("button", "add"); 
                    addButton.dataset.row = rowCount;
                    addButton.addEventListener("click", function () {
                        empty = true;
                        const pressed = this.dataset.row;

                        extraRows.push(Number(pressed));
                        extraRows.sort((a, b) => a - b);
                        maxCount = Math.max(
                            ...extraRows.map(n => extraRows.filter(x => x === n).length)
                        );

                        newCount = startColumns + maxCount;
                        
                        clearHoll();
                        setHollStyle(holl, newCount);
                        createHoll(newCount, empty);
                    });
                    holl.appendChild(addButton);
                    t = 0;
                    // k = 0;
                    rowCount++;
                }
                
                t++;
            }
        }

        function removeEl(className){
            const element = document.querySelectorAll(className);   
            element.forEach(el =>
                el.remove()
            );
        }

        function createHoll(extraColumns=0, empty=false){
            const holl = document.getElementById("holl");
            const rows = getData("rows");            
            let columns = 0;

            if(extraColumns > 0){
                columns = extraColumns;
            }
            else{
                columns = getData("columns");
                startColumns = columns;
            }

            createFill(holl, rows, columns, empty);
            setHollStyle(holl, columns);
            // setSeatStyle("seat");
        }

        function clearHoll(){
            removeEl(".seat");
            removeEl(".add");
            removeEl(".empty");
        }

        function main(){
            clearHoll();
            createHoll();
        }
        
    </script>
</body>
</html>